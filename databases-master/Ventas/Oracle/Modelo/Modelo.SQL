Rem Empresa        :  EGCC
Rem Software       :  Sistema de Ventas
Rem DBMS           :  Oracle
Rem Esquema        :  ventas
Rem Script         :  Crea el esquema con sus respectivas tablas
Rem Responsable    :  Ing. Eric Gustavo Coronel Castillo
Rem Telefono       :  (511) 9966-64457
Rem Email          :  gcoronelc@gmail.com
Rem Blog           :  http://gcoronelc.blogspot.com
Rem Creado el      :  20-FEB-2015

Rem 20-FEB-2015 Se agrega la tabla USUARIO.
Rem 20-FEB-2015 Se modifica la PK de la tabla PAGO y se agrega un UNIQUE (IdVenta,IdTipo)

Rem ============================================
Rem DESHABILITAR SALIDAS
Rem ============================================

SET TERMOUT OFF
SET ECHO OFF

-- =============================================
-- CRACIÓN DEL USUARIO
-- =============================================

DECLARE
	N INT;
	COMMAND VARCHAR2(200);
BEGIN
	COMMAND := 'DROP USER VENTAS CASCADE';
	SELECT COUNT(*) INTO N
	FROM DBA_USERS
	WHERE USERNAME = 'VENTAS';
	IF ( N = 1 ) THEN
		EXECUTE IMMEDIATE COMMAND;
	END IF;
END;
/

CREATE USER ventas IDENTIFIED BY admin;

GRANT CONNECT, RESOURCE TO ventas;
GRANT CREATE VIEW TO ventas;


-- =============================================
-- CONECTARSE A ORACLE
-- =============================================

CONNECT ventas/admin


-- =============================================
-- CREACION DE TABLAS DE EMPLEADOS
-- =============================================

CREATE TABLE EMPLEADO
(
	idemp                INTEGER NOT NULL ,
	nombre               VARCHAR2(50) NOT NULL ,
	apellido             VARCHAR2(50) NOT NULL ,
	email                VARCHAR2(50) NOT NULL ,
	telefono             VARCHAR2(20) NULL ,
CONSTRAINT  XPKEMPLEADO PRIMARY KEY (idemp)
);

CREATE SEQUENCE SQ_EMPLEADO
INCREMENT BY 1
START WITH 2001;


INSERT INTO EMPLEADO(IDEMP,NOMBRE,APELLIDO,EMAIL,TELEFONO) 
VALUES(1001,'CLAUDIA','RAMOS','cramos@gmail.com',NULL);

INSERT INTO EMPLEADO(IDEMP,NOMBRE,APELLIDO,EMAIL,TELEFONO)  
VALUES(1002,'ANGELICA','TORRES','atorres@gmail.com','967345634');

INSERT INTO EMPLEADO(IDEMP,NOMBRE,APELLIDO,EMAIL,TELEFONO)  
VALUES(1003,'KARLA','GUTIERREZ','kgutierrez@gmail.com','995466783');

INSERT INTO EMPLEADO(IDEMP,NOMBRE,APELLIDO,EMAIL,TELEFONO)  
VALUES(1004,'LEONOR','CARRASCO','lcarrasco@gmail.com','986754373');

COMMIT;

-- =============================================
-- CREACION DE TABLAS DEL USUARIOS
-- =============================================

CREATE TABLE USUARIO
(
	idemp                INTEGER NOT NULL ,
	usuario              VARCHAR2(20) NOT NULL ,
	clave                VARCHAR2(40) NOT NULL ,
	estado               NUMBER(2,0) NOT NULL  
    CONSTRAINT  CHK_USUARIO_ESTADO CHECK (estado IN (1, 0)),
CONSTRAINT  XPKUSUARIO PRIMARY KEY (idemp),
CONSTRAINT FK_USUARIO_EMPLEADO 
    FOREIGN KEY (idemp) REFERENCES EMPLEADO (idemp)
);

-- Clave: suerte
INSERT INTO USUARIO(IDEMP, USUARIO, CLAVE, ESTADO)
VALUES(1002,'atorres','38ea2969155dc3b534271971753347a680ca572e',1);

-- Clave: alegria
INSERT INTO USUARIO(IDEMP, USUARIO, CLAVE, ESTADO)
VALUES(1003,'kgutierrez','f92e29bc0f5dce40d7045a1fc3fa5495612c1093',1);

-- Clave: felicidad
INSERT INTO USUARIO(IDEMP, USUARIO, CLAVE, ESTADO)
VALUES(1004,'lcarrasco','ed4b248ce0d0bd5158df63ad7ad1351009a9e3dd',0);

COMMIT;

-- =============================================
-- CREACION DE TABLAS DEL CATALOGO
-- =============================================


CREATE TABLE CATEGORIA
(
	IDCAT                INTEGER NOT NULL ,
	NOMBRE               VARCHAR2(100) NOT NULL ,
	CONSTRAINT PK_CATEGORIA PRIMARY KEY( IDCAT ) ,
	CONSTRAINT U_CATEGORIA_NOMBRE UNIQUE( NOMBRE )
);

INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(501,'LINEA BLANCA');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(502,'MENAJE');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(503,'CAMA');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(504,'MUEBLES');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(505,'ROPA DE DAMAS');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(506,'ROPA DE CABALLEROS');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(507,'ROPA DE SEÑORITAS');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(508,'ROPA DE NIÑOS');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(509,'ROPA DE NIÑAS');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(510,'ELECTRODOMESTICOS');
INSERT INTO CATEGORIA(IDCAT,NOMBRE) VALUES(511,'COMPUTO');
COMMIT;

CREATE SEQUENCE SQ_CATEGORIA
INCREMENT BY 1
START WITH 601;


CREATE TABLE PRODUCTO
(
	IDPROD               INTEGER NOT NULL ,
	IDCAT                INTEGER NOT NULL ,
	NOMBRE               VARCHAR2(100) NOT NULL ,
	PRECIO               NUMBER(10,2) NOT NULL ,
	STOCK                INTEGER NOT NULL ,
	CONSTRAINT  PK_PRODUCTO PRIMARY KEY (IDPROD) ,
	CONSTRAINT FK_PRODUCTO_CATEGORIA 
		FOREIGN KEY (IDCAT) REFERENCES CATEGORIA (IDCAT)
);

CREATE SEQUENCE SQ_PRODUCTO
INCREMENT BY 1
START WITH 1001;

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,501,'COCINA',900.0,456);

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,507,'PANTALON',150.0,4567);

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,501,'REFRIGERADORA',1300.0,690);

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,507,'POLO DE VERANO',95.00,150);

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,506,'CAMISA COLOR VERDE',140.00,250);

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,506,'CAMISA DE CUADROS PEQUEÑOS',140.00,350);

INSERT INTO PRODUCTO(IDPROD,IDCAT,NOMBRE,PRECIO,STOCK)
VALUES(SQ_PRODUCTO.NEXTVAL,506,'PANTALON MODELO A1',1180.00,450);

COMMIT;



-- =============================================
-- CREACION DE TABLAS DE VENTAS
-- =============================================

CREATE TABLE VENTA
(
	IDVENTA              INTEGER NOT NULL ,
	CLIENTE              VARCHAR2(100) NOT NULL ,
	IDEMP                INTEGER NULL ,
	FECHA                DATE NOT NULL ,
	IMPORTE              NUMBER(10,2) NOT NULL ,
	CONSTRAINT  PK_VENTA PRIMARY KEY (IDVENTA) ,
	CONSTRAINT FK_VENTA_EMPLEADO 
		FOREIGN KEY (IDEMP) REFERENCES EMPLEADO (IDEMP)
);

CREATE SEQUENCE SQ_VENTA
INCREMENT BY 1
START WITH 1;

CREATE TABLE DETALLE
(
	IDDETALLE            INTEGER NOT NULL ,
	IDVENTA              INTEGER NOT NULL ,
	IDPROD               INTEGER NOT NULL ,
	PRECIO               NUMBER(10,2) NOT NULL ,
	CANT                 NUMBER NOT NULL ,
	SUBTOTAL             NUMBER(10,2) NULL ,
	CONSTRAINT  PK_DETALLE PRIMARY KEY (IDDETALLE) ,
	CONSTRAINT  U_DETALLE UNIQUE (IDVENTA,IDPROD) ,
	CONSTRAINT FK_DETALLE_PRODUCTO FOREIGN KEY (IDPROD) REFERENCES PRODUCTO(IDPROD) ,
	CONSTRAINT FK_DETALLE_VENTA FOREIGN KEY (IDVENTA) REFERENCES VENTA (IDVENTA)
);


-- =============================================
-- CREACION DE TABLAS DE PAGOS
-- =============================================

CREATE TABLE TIPO_PAGO
(
	IDTIPO               INTEGER NOT NULL ,
	NOMBRE               VARCHAR2(50) NOT NULL ,
	CONSTRAINT  PK_TIPO_PAGO PRIMARY KEY (IDTIPO)
);

INSERT INTO TIPO_PAGO(IDTIPO,NOMBRE) VALUES(11,'EFECTIVO');
INSERT INTO TIPO_PAGO(IDTIPO,NOMBRE) VALUES(12,'TARJETA CREDITO');
INSERT INTO TIPO_PAGO(IDTIPO,NOMBRE) VALUES(13,'TARJETA DE DEBITO');
INSERT INTO TIPO_PAGO(IDTIPO,NOMBRE) VALUES(14,'CHEQUE');
INSERT INTO TIPO_PAGO(IDTIPO,NOMBRE) VALUES(15,'NOTA DE CREDITO');
INSERT INTO TIPO_PAGO(IDTIPO,NOMBRE) VALUES(16,'BONO EFECTIVO');
COMMIT;	


CREATE TABLE PAGO
(
	idpago               INTEGER NOT NULL ,
	idventa              INTEGER NOT NULL ,
	idtipo               INTEGER NOT NULL ,
	detalle              VARCHAR2(100) NOT NULL ,
	importe              NUMBER(10,2) NOT NULL ,
	obs                  NVARCHAR2(1000) NOT NULL ,
CONSTRAINT  XPKPAGO PRIMARY KEY (idpago),
CONSTRAINT  U_PAGO_UNIQUE UNIQUE (idventa,idtipo),
CONSTRAINT FK_PAGO_VENTA FOREIGN KEY (idventa) REFERENCES VENTA (idventa),
CONSTRAINT FK_PAGO_TIPO_PAGO FOREIGN KEY (idtipo) REFERENCES TIPO_PAGO (idtipo)
);


CREATE SEQUENCE SQ_PAGO
INCREMENT BY 1
START WITH 1;


-- =============================================
-- HABILITAR SALIDAS
-- =============================================

SET TERMOUT ON
SET ECHO ON
SHOW USER
SET LINESIZE 400
SET PAGESIZE 5000
SELECT * FROM CAT;
SELECT SEQUENCE_NAME, LAST_NUMBER FROM USER_SEQUENCES;
